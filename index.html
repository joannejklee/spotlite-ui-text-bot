<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Spotlite UI Text Bot</title>
  <style>
    :root {
      --bg1:#667eea; --bg2:#764ba2;
      --ink:#222; --sub:#666; --line:#e1e5e9; --soft:#f8f9fa; --ok:#28a745; --warn:#fff3cd; --warnline:#ffeaa7; --err:#f8d7da; --errline:#f5c6cb;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      min-height: 100vh; display: flex; align-items: center; justify-content: center;
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      padding: 20px;
    }
    .container {
      width:100%; max-width: 860px; background:#fff; border-radius:16px; padding:32px;
      box-shadow: 0 20px 40px rgba(0,0,0,.12);
    }
    .header { text-align:center; margin-bottom: 24px; }
    .logo { font-weight: 800; font-size: 22px; letter-spacing:.2px; color:var(--ink); }
    .subtitle { color:var(--sub); font-size: 13px; margin-top:6px;}
    label { display:block; font-weight:600; color:var(--ink); margin-bottom:8px; font-size:13px; }
    textarea, select {
      width:100%; border:2px solid var(--line); border-radius:10px; padding:14px; font-size:14px; transition: border-color .2s;
      background:#fff; font-family:inherit;
    }
    textarea:focus, select:focus { outline: none; border-color: var(--bg1); }
    textarea { min-height: 120px; resize: vertical; }
    .row { display:flex; gap:16px; }
    .col { flex:1; }
    .btn {
      margin-top:6px; width:100%; background:linear-gradient(135deg, var(--bg1), var(--bg2));
      color:#fff; border:none; border-radius:10px; padding:14px 18px; font-size:16px; font-weight:700; cursor:pointer;
      transition: transform .15s, box-shadow .15s;
    }
    .btn:hover { transform: translateY(-1px); box-shadow:0 10px 22px rgba(102,126,234,.28); }
    .btn:disabled { opacity:.65; cursor:not-allowed; }
    .status { margin-top:12px; border-radius:10px; padding:12px; font-size:13px; text-align:center; }
    .status.warn { background:var(--warn); border:1px solid var(--warnline); color:#856404; }
    .status.err { background:var(--err); border:1px solid var(--errline); color:#721c24; }

    .section { margin-top:28px; }
    .box {
      background: #fff; border:2px solid var(--line); border-radius:10px; padding:14px; min-height:70px; font-size:14px; line-height:1.5;
    }
    .box.ready { background:#fff; border-color:var(--ok); }
    .notes { background:#fff7d6; border:2px solid #ffeab2; border-radius:10px; padding:12px; font-size:13px; margin-top:12px; }
    .notes:empty { display:none; }
    .meta { background:#f1f3f5; border-radius:8px; padding:10px; font-size:12px; color:#495057; margin-top:10px; }
    .meta .row { display:flex; justify-content:space-between; gap:10px; }
    @media (max-width:700px){ .row{flex-direction:column;} }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">Spotlite UI Text Bot</div>
      <div class="subtitle">Deterministic rules → Gemini polish/translate</div>
    </div>

    <form id="form">
      <div class="section">
        <label for="inputText">Input Text</label>
        <textarea id="inputText" name="inputText" placeholder="Enter your UI text…"></textarea>
      </div>

      <div class="row section">
        <div class="col">
          <label for="targetLang">Target Language</label>
          <select id="targetLang" name="targetLang">
            <option value="auto">Auto-detect</option>
            <option value="ko">Korean</option>
            <option value="en">English</option>
          </select>
        </div>
        <div class="col">
          <label for="component">Component</label>
          <select id="component" name="component">
            <option value="freeform">Loading…</option>
          </select>
        </div>
      </div>

      <button id="submitBtn" class="btn" type="submit">Polish Text</button>
      <div id="status" class="status" style="display:none"></div>
    </form>

    <div class="section">
      <label>Processed Text</label>
      <div id="output" class="box">Results will appear here…</div>
      <div id="notes" class="notes"></div>
      <div id="meta" class="meta" style="display:none"></div>
    </div>
  </div>

  <script>
    // 👉 Replace this with your current Web App URL (Manage deployments → Web app URL)
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbzkJX_dr-beCstZbRbCBefR7Ek9D0kdM28Si-4cdAvqwsgs5m0Vz2OLjohIWq0jksmj/exec';

    const $ = sel => document.querySelector(sel);
    const form = $('#form');
    const componentSel = $('#component');
    const statusEl = $('#status');
    const outputEl = $('#output');
    const notesEl = $('#notes');
    const metaEl = $('#meta');
    const btn = $('#submitBtn');

    let components = [];

    document.addEventListener('DOMContentLoaded', async () => {
      try {
        const r = await fetch(GAS_URL + '?meta=1');
        const data = await r.json();
        if (data.ok) {
          components = data.components || [];
          renderComponents(components);
        } else {
          warn('⚠️ Using default components');
          renderComponents(['freeform','button','toast','notification.title','notification.body','placeholder']);
        }
      } catch (e) {
        console.error(e);
        warn('⚠️ Using default components (meta fetch failed)');
        renderComponents(['freeform','button','toast','notification.title','notification.body','placeholder']);
      }
    });

    function renderComponents(list) {
      componentSel.innerHTML = '';
      if (!list.includes('freeform')) list = ['freeform', ...list];
      list.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c;
        opt.textContent = c;
        componentSel.appendChild(opt);
      });
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const input = $('#inputText').value.trim();
      const targetLang = $('#targetLang').value;
      const component = $('#component').value;
      if (!input) return showError('Please enter some text.');

      setBusy(true);
      clearOut();

      try {
        const body = new URLSearchParams({ q: JSON.stringify({ text: input, targetLang, component }) });
        const r = await fetch(GAS_URL, { method: 'POST', body });
        const data = await r.json();

        if (data.ok) {
          outputEl.textContent = data.text || '(empty)';
          outputEl.classList.add('ready');
          const parts = [];
          if (data.issues && data.issues.length) parts.push('Issues: ' + data.issues.join('; '));
          if (data.disclaimers && data.disclaimers.length) parts.push(data.disclaimers.join(' '));
          notesEl.innerHTML = parts.join('<br>');

          // meta
          if (data.meta) {
            const m = data.meta;
            metaEl.innerHTML =
              `<div class="row"><div>Source</div><div>${m.sourceLang}</div></div>` +
              `<div class="row"><div>Target</div><div>${m.targetLang}</div></div>` +
              `<div class="row"><div>Component</div><div>${m.component}</div></div>` +
              (m.steps && m.steps.length ? `<div class="row"><div>Steps</div><div>${m.steps.join(' → ')}</div></div>` : '') +
              (m.replacements && m.replacements.length
                ? `<div class="row"><div>Replacements</div><div>${m.replacements.map(r => `${r.original} → ${r.replacement}`).join(', ')}</div></div>`
                : '');
            metaEl.style.display = 'block';
          }
        } else {
          showError(data.error || 'Processing error');
          outputEl.textContent = data.text || '';
        }
      } catch (err) {
        console.error(err);
        showError('Connection failed. Check the Web App URL.');
      } finally {
        setBusy(false);
      }
    });

    function setBusy(on) {
      btn.disabled = on;
      btn.textContent = on ? 'Processing…' : 'Polish Text';
    }
    function clearOut() {
      outputEl.textContent = 'Processing…';
      outputEl.classList.remove('ready');
      notesEl.innerHTML = '';
      metaEl.style.display = 'none';
      statusEl.style.display = 'none';
    }
    function warn(msg){ showStatus(msg, 'warn'); }
    function showError(msg){ showStatus(msg, 'err'); }
    function showStatus(msg, cls){
      statusEl.textContent = msg;
      statusEl.className = 'status ' + cls;
      statusEl.style.display = 'block';
      setTimeout(() => { statusEl.style.display='none'; }, 4000);
    }
  </script>
</body>
</html>
